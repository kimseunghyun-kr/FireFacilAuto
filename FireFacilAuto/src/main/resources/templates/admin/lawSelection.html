<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Law Selection</title>
    <link rel="stylesheet" type="text/css" th:href="@{/styles.css}">
    <style>
        .tab {
            display: none;
        }

        .tab.active {
            display: block;
        }
    </style>

    <script th:inline="javascript">
        function validateAndSubmitForm() {
            let form = document.getElementsByName('form');
            let inputs = form.getElementsByTagName('input');

            for (let i = 0; i < inputs.length; i++) {
                let input = inputs[i];
                if (input.type === 'text' && input.value.trim() === '') {
                    // Skip radio buttons associated with empty text inputs
                    let radioName = 'conditions[' + input.id + ']';
                    let radios = form.querySelectorAll('[name="' + radioName + '"]');
                    for (let j = 0; j < radios.length; j++) {
                        radios[j].disabled = true;
                    }
                }
            }

            // Submit the form
            form.submit();
        }

        function openTab(tabName) {
            // remove all
            let tabcontent = document.getElementsByClassName("tab");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            document.getElementById(tabName).style.display = "block";
            PurposeData = [];
        }

        let PurposeData = [];

        function addPurpose(listName) {
            // Find the container where you want to append new input fields
            let container = document.getElementById(listName + 'Container');

            // Create a new div for the input fields
            let newDiv = document.createElement('div');
            newDiv.className = listName +'Input';
            newDiv.setAttribute('data-index', container.children.length);

            // Create labels and input fields
            let classificationLabel = document.createElement('label');
            classificationLabel.textContent = 'Classification:';
            let classificationInput = document.createElement('input');
            classificationInput.type = 'text';
            classificationInput.name = listName + 'Classification';
            classificationInput.setAttribute('th:field', '*{' + listName + '[' + container.children.length + '].classification}');

            let specificationLabel = document.createElement('label');
            specificationLabel.textContent = 'Specification:';
            let specificationInput = document.createElement('input');
            specificationInput.type = 'text';
            specificationInput.name = listName + 'Specification';
            specificationInput.setAttribute('th:field', '*{' + listName + '[' + container.children.length + '].specification}');

            // Append labels and input fields to the new div
            newDiv.appendChild(classificationLabel);
            newDiv.appendChild(classificationInput);
            newDiv.appendChild(specificationLabel);
            newDiv.appendChild(specificationInput);

            // Append the new div to the container
            container.insertBefore(newDiv, container.lastElementChild);

            PurposeData.push({
                classification: '',
                specification: ''
            });

            updateThymeleafFields(listName);
            console.log(PurposeData)
        }

        function updateThymeleafFields(listName) {
            PurposeData.forEach((data, index) => {
                // Update the Thymeleaf fields based on the array
                document.querySelector(`[data-index="${index}"] [name="${listName}Classification"]`).value = data.classification;
                document.querySelector(`[data-index="${index}"] [name="${listName}Specification"]`).value = data.specification;
            });
        }

        function removeLast(listName) {
            let container = document.getElementById(listName + 'Container');
            let lastDiv = container.lastElementChild;

            if (lastDiv && container.children.length > 0) {
                container.removeChild(lastDiv);
                // Remove the last item from the JavaScript array
                PurposeData.pop();

                // Update Thymeleaf fields based on the modified JavaScript array
                updateThymeleafFields(listName);
            }


        }
    </script>

</head>
<body>

<h1>Law Selection</h1>

<!-- Tab navigation -->
<ul>
    <li><a href="#" onclick="openTab('buildingTab')">Building Law Fields</a></li>
    <li><a href="#" onclick="openTab('floorTab')">Floor Law Fields</a></li>
</ul>

<!--<div th:if="${formUtilityMethod != null}">-->
<!--    &lt;!&ndash; Debug output &ndash;&gt;-->
<!--    <p th:text="${formUtilityMethod.buildingFieldAssociableWithCondition('texas')}">formUtilityMethod</p>-->

<!-- Include building tab -->
<div th:insert="~{admin/buildingTab.html :: buildingTab (${buildingForm}, ${formUtilityMethod}, ${formUtilityMethod.allBuildingFields()})}"></div>

<!-- Include floor tab -->
<div th:insert="~{admin/floorTab.html :: floorTab (${floorForm}, ${formUtilityMethod}, ${formUtilityMethod.allFloorFields()})}"></div>

<!-- JavaScript function to switch tabs -->

</body>
</html>